<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß† Ultimate Overthinking Engine‚Ñ¢ - Gemini API Test</h1>
        <p>This test verifies that the Gemini API integration is working correctly.</p>
        
        <button onclick="runTest()">Run Gemini API Test</button>
        
        <div id="test-output" class="test-result loading">
            Click the button above to test the Gemini API integration...
        </div>
        
        <div id="scenarios-output"></div>
    </div>

    <script>        async function runTest() {
            const output = document.getElementById('test-output');
            const scenariosOutput = document.getElementById('scenarios-output');
            
            output.className = 'test-result loading';
            output.textContent = 'Testing Gemini API integration...\nThis may take a few seconds...';
            scenariosOutput.innerHTML = '';
              const apiKey = 'AIzaSyBnE2E-0BOQop43TY5Dry4R1buLFGkiSeo';
            const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
            
            const testPrompt = `You are the Ultimate Overthinking Engine‚Ñ¢. Generate 3 hilariously catastrophic worst-case scenarios for choosing coffee over tea. Make each scenario absurdly over-dramatic, include butterfly effects, and end with completely unrealistic consequences. Each scenario should be 1-2 sentences. Return only the scenarios, one per line.`;
            
            try {
                console.log('üîç Testing Gemini API...');
                console.log('üåê API URL:', apiUrl);
                console.log('üîë API Key:', apiKey.substring(0, 20) + '...');
                
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: testPrompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.9,
                        topK: 1,
                        topP: 1,
                        maxOutputTokens: 2048,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                };
                
                console.log('üì§ Request body:', JSON.stringify(requestBody, null, 2));
                  const response = await fetch(`${apiUrl}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': apiKey
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('üì° Response status:', response.status);
                console.log('üì° Response headers:', response.headers);
                
                const responseText = await response.text();
                console.log('üìÑ Raw response:', responseText);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}\nResponse: ${responseText}`);
                }

                const data = JSON.parse(responseText);
                console.log('üìÑ Parsed API Response:', data);
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const generatedText = data.candidates[0].content.parts[0].text;
                    console.log('‚ú® Generated text:', generatedText);
                    
                    const scenarios = generatedText
                        .split('\n')
                        .map(line => line.trim())
                        .filter(line => line && !line.match(/^\d+\.?\s*$/) && line.length > 10)
                        .map(line => line.replace(/^\d+\.\s*/, '').replace(/^[-*]\s*/, ''));
                    
                    console.log('üéØ Parsed scenarios:', scenarios);
                    
                    output.className = 'test-result success';
                    output.textContent = `‚úÖ SUCCESS! Gemini API is working correctly!\n\nResponse Status: ${response.status}\nScenarios Generated: ${scenarios.length}\n\nAPI Integration: OPERATIONAL üöÄ`;
                    
                    if (scenarios.length > 0) {
                        scenariosOutput.innerHTML = `
                            <div class="test-result success">
                                <h3>üé≠ Generated Scenarios:</h3>
                                ${scenarios.map((scenario, index) => `<p><strong>${index + 1}.</strong> ${scenario}</p>`).join('')}
                            </div>
                        `;
                    }
                    
                    return scenarios;
                } else {
                    console.error('‚ùå Unexpected API response structure:', data);
                    throw new Error('Unexpected API response structure');
                }
                
            } catch (error) {
                console.error('‚ùå Gemini API Test Failed:', error);
                
                output.className = 'test-result error';
                output.textContent = `‚ùå TEST FAILED!\n\nError: ${error.message}\n\nThe application will use fallback scenarios instead.\nCheck the browser console for more details.`;
                
                scenariosOutput.innerHTML = `
                    <div class="test-result error">
                        <h3>‚ö†Ô∏è Fallback Scenarios (Static):</h3>
                        <p><strong>1.</strong> Your coffee choice triggers a global tea shortage, leading to worldwide calm deficiency and chaos</p>
                        <p><strong>2.</strong> This decision creates a butterfly effect that accidentally prevents British civilization</p>
                        <p><strong>3.</strong> Your choice somehow disrupts caffeine-time continuum, making mornings impossible</p>
                        <br>
                        <h4>üîß Troubleshooting Tips:</h4>
                        <ul>
                            <li>Check if the API key is valid and has quota remaining</li>
                            <li>Verify internet connection</li>
                            <li>Check browser console for CORS or network errors</li>
                            <li>Ensure the Gemini API service is available</li>
                        </ul>
                    </div>
                `;
                
                return ['Fallback scenario 1', 'Fallback scenario 2', 'Fallback scenario 3'];
            }
        }
        
        // Auto-run test on page load
        window.addEventListener('load', () => {
            console.log('üß† Ultimate Overthinking Engine‚Ñ¢ API Test Page Loaded');
            console.log('üí° Click the test button to verify Gemini API integration');
        });
    </script>
</body>
</html>
